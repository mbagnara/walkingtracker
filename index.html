<!DOCTYPE html>
<html>
<head>
  <title>Walk Tracker</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <h1>Walk Tracker</h1>
  <form id="walkForm">
    <label for="date">Date:</label>
    <input type="date" id="date" required>
    <label for="miles">Miles:</label>
    <input type="number" id="miles" required>
    <button type="button" onclick="addRow()">Add</button>
  </form>
  <br>
  <button onclick="deleteAllData()">Delete all data</button>
  <table id="walkTable">
    <thead>
      <tr>
        <th>Index</th>
        <th>Date</th>
        <th>Miles</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Existing data rows will be added here dynamically -->
    </tbody>
  </table>

  <script>
    function addRow() {
      var dateInput = document.getElementById("date");
      var milesInput = document.getElementById("miles");
      var table = document.getElementById("walkTable").getElementsByTagName('tbody')[0];

      if (dateInput.value === "") {
        dateInput.value = getCurrentDate(); // Suggest the current date if the field is empty
      }

      if (milesInput.value <= 0) {
        alert("Please enter a positive number for miles.");
        return;
      }

      // Save the new walk data to localStorage
      var walks = JSON.parse(localStorage.getItem("walks")) || [];
      var rowIndex = walks.length;
      walks.push({ date: dateInput.value, miles: milesInput.value });
      localStorage.setItem("walks", JSON.stringify(walks));

      // Add the new row to the table
      var newRow = table.insertRow();
      var indexCell = newRow.insertCell();
      var dateCell = newRow.insertCell();
      var milesCell = newRow.insertCell();
      var actionsCell = newRow.insertCell();
      indexCell.textContent = rowIndex;
      dateCell.textContent = dateInput.value;
      milesCell.textContent = milesInput.value;
      actionsCell.innerHTML = '<button onclick="editRow(this)">Edit</button> <button onclick="deleteRow(this, ' + rowIndex + ')">Delete</button>';

      // Reset the form inputs
      dateInput.value = "";
      milesInput.value = "";
    }

    function editRow(button) {
      var row = button.parentNode.parentNode;
      var dateCell = row.cells[1];
      var milesCell = row.cells[2];

      var dateValue = dateCell.textContent;
      var milesValue = milesCell.textContent;

      dateCell.innerHTML = '<input type="date" value="' + dateValue + '">';
      milesCell.innerHTML = '<input type="number" value="' + milesValue + '">';

      var actionsCell = row.cells[3];
      actionsCell.innerHTML = '<button onclick="saveEdit(this)">Save</button> <button onclick="cancelEdit(this)">Cancel</button>';
    }

    function saveEdit(button) {
      var row = button.parentNode.parentNode;
      var dateCell = row.cells[1];
      var milesCell = row.cells[2];

      var dateInput = dateCell.querySelector("input[type='date']");
      var milesInput = milesCell.querySelector("input[type='number']");

      dateCell.textContent = dateInput.value;
      milesCell.textContent = milesInput.value;

      // Update the walk data in localStorage
      var rowIndex = getRowIndex(row);
      var walks = JSON.parse(localStorage.getItem("walks"));
      walks[rowIndex].date = dateInput.value;
      walks[rowIndex].miles = milesInput.value;
      localStorage.setItem("walks", JSON.stringify(walks));

      var actionsCell = row.cells[3];
      actionsCell.innerHTML = '<button onclick="editRow(this)">Edit</button> <button onclick="deleteRow(this, ' + rowIndex + ')">Delete</button>';
    }

    function cancelEdit(button) {
      var row = button.parentNode.parentNode;
      var dateCell = row.cells[1];
      var milesCell = row.cells[2];

      dateCell.innerHTML = dateCell.querySelector("input[type='date']").value;
      milesCell.innerHTML = milesCell.querySelector("input[type='number']").value;

      var actionsCell = row.cells[3];
      actionsCell.innerHTML = '<button onclick="editRow(this)">Edit</button> <button onclick="deleteRow(this, ' + rowIndex + ')">Delete</button>';
    }

    function deleteRow(button, rowIndex) {
      var row = button.parentNode.parentNode;
      var table = row.parentNode;

      var confirmation = confirm("Are you sure you want to delete row " + rowIndex + "?");
      if (!confirmation) {
        return;
      }

      table.deleteRow(row.rowIndex);

      // Remove the walk data from localStorage
      var walks = JSON.parse(localStorage.getItem("walks"));
      walks.splice(rowIndex, 1);
      localStorage.setItem("walks", JSON.stringify(walks));

      updateRowIndices(); // Update row indices after deletion
    }

    function deleteAllData() {
      // Remove all walk data from localStorage
      localStorage.removeItem("walks");

      // Clear the table body
      var table = document.getElementById("walkTable").getElementsByTagName("tbody")[0];
      table.innerHTML = "";
    }

    function getRowIndex(row) {
      var rows = document.getElementById("walkTable").getElementsByTagName("tr");
      for (var i = 0; i < rows.length; i++) {
        if (rows[i] === row) {
          return i - 1;
        }
      }
      return -1;
    }

    function getCurrentDate() {
      var currentDate = new Date();
      var year = currentDate.getFullYear();
      var month = ("0" + (currentDate.getMonth() + 1)).slice(-2);
      var day = ("0" + currentDate.getDate()).slice(-2);
      return year + "-" + month + "-" + day;
    }

    function updateRowIndices() {
      var rows = document.getElementById("walkTable").getElementsByTagName("tr");
      for (var i = 1; i < rows.length; i++) {
        var indexCell = rows[i].cells[0];
        indexCell.textContent = i - 1;
      }
    }

    // Load existing walks from localStorage when the page loads
    document.addEventListener("DOMContentLoaded", function() {
      var walks = JSON.parse(localStorage.getItem("walks")) || [];
      var table = document.getElementById("walkTable").getElementsByTagName('tbody')[0];

      for (var i = 0; i < walks.length; i++) {
        var newRow = table.insertRow();
        var indexCell = newRow.insertCell();
        var dateCell = newRow.insertCell();
        var milesCell = newRow.insertCell();
        var actionsCell = newRow.insertCell();
        indexCell.textContent = i;
        dateCell.textContent = walks[i].date;
        milesCell.textContent = walks[i].miles;
        actionsCell.innerHTML = '<button onclick="editRow(this)">Edit</button> <button onclick="deleteRow(this, ' + i + ')">Delete</button>';
      }
    });
  </script>
</body>
</html>
